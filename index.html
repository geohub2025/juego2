<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POWER-MILEY</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  background: url('sky.png') no-repeat center center fixed;
  background-size: cover;
  font-family: Arial, sans-serif;
  color: white;
}
canvas {
  display: block;
  margin: 0 auto;
  touch-action: none; /* evita scroll al jugar */
}

/* Pantalla de inicio */
#startScreen {
  position: absolute;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  text-align: center;
  padding-top: 100px;
  z-index: 10;
}
#startScreen h1 {
  font-size: 64px;
  color: #00ffcc;
  margin-bottom: 10px;
}
#startScreen p {
  font-size: 20px;
  color: white;
  margin-bottom: 30px;
}
#icons img {
  width: 60px;
  height: 60px;
  margin: 10px;
  filter: drop-shadow(0 0 8px #00ffff);
}

/* HUD */
#hud {
  position: absolute;
  top: 10px;
  left: 20px;
  font-size: 16px;
}

.label { font-weight: bold; margin-bottom: 2px; }

.bar {
  width: 220px;
  height: 20px;
  background: rgba(255,255,255,0.2);
  border: 1px solid white;
  margin-bottom: 10px;
  border-radius: 4px;
  overflow: hidden;
}
.fill { height: 100%; transition: width 0.2s; }
#lifeFill { background: limegreen; width: 100%; }
#energyFill { background: deepskyblue; width: 100%; }
#score { font-size: 18px; margin-top: 8px; }

#killCount {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-top: 8px;
}
.killIcon { width: 30px; height: 30px; }

#specialContainer {
  position: absolute;
  top: 10px;
  right: 20px;
  display: flex;
  align-items: center;
  font-weight: bold;
}
#specialIcon {
  width: 50px;
  height: 50px;
  margin-right: 5px;
  display: none;
}

/* GAME OVER / WIN */
#gameOver, #winScreen {
  position: absolute;
  top: 45%;
  width: 100%;
  text-align: center;
  font-size: 40px;
  font-weight: bold;
  display: none;
}
#gameOver { color: red; }
#winScreen { color: #00ffcc; }

/* Controles m√≥viles */
#mobileControls {
  position: absolute;
  bottom: 20px;
  width: 100%;
  display: flex;
  justify-content: space-between;
  padding: 0 20px;
  pointer-events: none;
}

.btn {
  pointer-events: auto;
  width: 90px;
  height: 90px;
  border-radius: 50%;
  background: rgba(255,255,255,0.2);
  border: 2px solid white;
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 22px;
  user-select: none;
}

</style>
</head>
<body>

<div id="startScreen">
  <h1>POWER-MILEY</h1>
  <p>Toque para comenzar</p>
  <div id="icons">
    <img src="ship.png"><img src="star.png"><img src="power.png">
    <img src="specialpower.png"><img src="enemy.png"><img src="enemy2.png">
    <img src="badenergy2.png"><img src="bomb.png"><img src="megarayo.png">
  </div>
</div>

<div id="hud" style="display:none;">
  <div class="label">VIDA</div>
  <div class="bar"><div id="lifeFill" class="fill"></div></div>
  <div class="label">ENERG√çA</div>
  <div class="bar"><div id="energyFill" class="fill"></div></div>
  <div id="score">Puntaje: 0</div>
  <div id="killCount">
    <img src="enemy.png" class="killIcon">
    <img src="enemy2.png" class="killIcon">
    <span id="kills">0</span>
  </div>
</div>

<div id="specialContainer" style="display:none;">
  <img id="specialIcon" src="specialpower.png">
  <div id="megaCounter">0</div>
</div>

<div id="gameOver">GAME OVER<br><small>Recargue para reiniciar</small></div>
<div id="winScreen">¬°GANASTE!<br><small>Eliminaste 30 enemigos</small></div>

<!-- Controles t√°ctiles -->
<div id="mobileControls">
  <div id="moveBtn" class="btn">‚¨Ü‚¨á</div>
  <div id="shootBtn" class="btn">üî•</div>
  <div id="megaBtn" class="btn">‚ö°</div>
</div>

<canvas id="gameCanvas" width="800" height="600"></canvas>

<script>
/* --- CONFIGURACI√ìN CANVAS RESPONSIVO --- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas(){
  const scale = Math.min(window.innerWidth / 800, window.innerHeight / 600);
  canvas.style.transform = `scale(${scale})`;
  canvas.style.transformOrigin = "top left";
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

/* ---- VARIABLES DEL JUEGO ---- */
const startScreen = document.getElementById('startScreen');
const hud = document.getElementById('hud');
const specialContainer = document.getElementById('specialContainer');
const lifeBar = document.getElementById('lifeFill');
const energyBar = document.getElementById('energyFill');
const scoreDisplay = document.getElementById('score');
const specialIcon = document.getElementById('specialIcon');
const megaCounter = document.getElementById('megaCounter');
const gameOverDisplay = document.getElementById('gameOver');
const winScreen = document.getElementById('winScreen');
const killsDisplay = document.getElementById('kills');

const shipImg = new Image(); shipImg.src = 'ship.png';
const shipDamageImg = new Image(); shipDamageImg.src = 'shipdamage.png';
const starImg = new Image(); starImg.src = 'star.png';
const enemyImg = new Image(); enemyImg.src = 'enemy.png';
const enemy2Img = new Image(); enemy2Img.src = 'enemy2.png';
const badEnergyImg = new Image(); badEnergyImg.src = 'badenergy.png';
const badEnergy2Img = new Image(); badEnergy2Img.src = 'badenergy2.png';
const bombImg = new Image(); bombImg.src = 'bomb.png';
const powerImg = new Image(); powerImg.src = 'power.png';
const specialImg = new Image(); specialImg.src = 'specialpower.png';
const megaHealImg = new Image(); megaHealImg.src = 'megarayo.png';

let started = false;
let ship = {x:350, y:450, width:50, height:50, speed:6};
let stars=[], enemies=[], enemies2=[], badShots=[], badShots2=[], bombs=[], powers=[], specials=[], megaHeals=[];
let life=100, energy=100, score=0, megaCount=0, enemiesKilled=0;
let megaRay=null, megaTimer=0, flashes=[], keys={};
let gameWon=false;

/* ---- EVENTOS PC ---- */
window.addEventListener('keydown', e=>{
  keys[e.key]=true;
  if(!started && e.key==="Enter") startGame();
});
window.addEventListener('keyup', e=> keys[e.key]=false );

/* ---- EVENTO T√ÅCTIL PARA EMPEZAR ---- */
startScreen.addEventListener("touchstart", ()=>{ if(!started) startGame(); });
startScreen.addEventListener("click", ()=>{ if(!started) startGame(); });

/* ---- CONTROLES M√ìVILES ---- */
let moveTouchY = null;

document.getElementById("moveBtn").addEventListener("touchstart", e=>{
  moveTouchY = e.touches[0].clientY;
});
document.getElementById("moveBtn").addEventListener("touchmove", e=>{
  const newY = e.touches[0].clientY;
  if(newY < moveTouchY - 20) ship.y -= ship.speed;
  if(newY > moveTouchY + 20) ship.y += ship.speed;
});
document.getElementById("moveBtn").addEventListener("touchend", ()=> moveTouchY=null );

document.getElementById("shootBtn").addEventListener("touchstart", ()=> shoot() );
document.getElementById("megaBtn").addEventListener("touchstart", ()=> shootMegaRay() );

/* ---- INICIO DEL JUEGO ---- */
function startGame(){
  started=true;
  startScreen.style.display="none";
  hud.style.display="block";
  specialContainer.style.display="flex";
  gameLoop();
}

/* ---- UTILIDADES ---- */
function collides(a,b){
  return a.x<b.x+b.width && a.x+a.width>b.x && a.y<b.y+b.height && a.y+a.height>b.y;
}

/* ---- DISPARO ---- */
function shoot(){
  if(energy>0){
    stars.push({x:ship.x+20,y:ship.y,width:10,height:20});
    energy -= 10;
  }
}

function shootMegaRay(){
  if(megaCount>0 && !megaRay){
    megaRay={x:ship.x+15,width:20};
    megaTimer=30;
    megaCount--;
    updateMegaUI();
  }
}

function updateMegaUI(){
  specialIcon.style.display = megaCount>0 ? 'block':'none';
  megaCounter.textContent = megaCount;
}

/* ---- UPDATE ---- */
function update(){

  if(life<=0){
    gameOverDisplay.style.display="block";
    return;
  }

  /* MOVIMIENTO PC */
  if(keys["ArrowLeft"]) ship.x -= ship.speed;
  if(keys["ArrowRight"]) ship.x += ship.speed;
  if(keys["ArrowUp"]) ship.y -= ship.speed;
  if(keys["ArrowDown"]) ship.y += ship.speed;
  if(keys[" "]) shoot();
  if(keys["x"]) shootMegaRay();

  /* Limites de pantalla */
  ship.x = Math.max(0, Math.min(canvas.width-ship.width, ship.x));
  ship.y = Math.max(0, Math.min(canvas.height-ship.height, ship.y));

  /* Actualizar proyectiles */
  stars.forEach(s=> s.y -= 8);
  stars = stars.filter(s=> s.y>-10);

  /* Enemigos */
  enemies.forEach(e=> e.y+=2);
  enemies2.forEach(e=>{
    e.y+=2;
    e.x += Math.sin(e.y*0.05)*3;
  });

  /* Colisiones */
  enemies = enemies.filter(e=>{
    if(stars.some(s=> collides(s,e))){
      enemiesKilled++; score+=10;
      return false;
    }
    return true;
  });

  enemies2 = enemies2.filter(e=>{
    if(stars.some(s=> collides(s,e))){
      enemiesKilled++; score+=20;
      return false;
    }
    return true;
  });

  /* MEGARAYO */
  if(megaRay){
    megaTimer--;
    enemies = enemies.filter(e=> !(e.x+e.width>megaRay.x && e.x<megaRay.x+megaRay.width) );
    enemies2 = enemies2.filter(e=> !(e.x+e.width>megaRay.x && e.x<megaRay.x+megaRay.width) );
    if(megaTimer<=0) megaRay=null;
  }

  /* VICTORIA */
  if(enemiesKilled>=30 && !gameWon){
    winScreen.style.display="block";
    gameWon=true;
  }

  /* UI */
  lifeBar.style.width = life+"%";
  energyBar.style.width = energy+"%";
  scoreDisplay.textContent = "Puntaje: "+score;
  killsDisplay.textContent = enemiesKilled;

  /* Spawns */
  if(Math.random()<0.03) enemies.push({x:Math.random()*750,y:-40,width:50,height:50});
  if(Math.random()<0.01) enemies2.push({x:Math.random()*750,y:-40,width:60,height:60});
}

/* ---- DRAW ---- */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  stars.forEach(s=> ctx.drawImage(starImg,s.x,s.y,s.width,s.height));
  enemies.forEach(e=> ctx.drawImage(enemyImg,e.x,e.y,e.width,e.height));
  enemies2.forEach(e=> ctx.drawImage(enemy2Img,e.x,e.y,e.width,e.height));

  if(megaRay){
    ctx.fillStyle = "rgba(0,255,255,0.5)";
    ctx.fillRect(megaRay.x,0,megaRay.width,canvas.height);
  }

  ctx.drawImage(shipImg,ship.x,ship.y,ship.width,ship.height);
}

/* ---- LOOP ---- */
function gameLoop(){
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

</script>
</body>
</html>


